#!/bin/bash

# =============================================================================
# –ü–†–û–°–ú–û–¢–† –õ–û–ì–û–í
# =============================================================================

set -e

SERVICE=${1:-all}
FOLLOW=${2:-false}

echo "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–ª—è: $SERVICE"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
show_help() {
    echo ""
    echo "üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./logs.sh [service] [follow]"
    echo ""
    echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:"
    echo "  all        - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
    echo "  web        - API —Å–µ—Ä–≤–µ—Ä"
    echo "  bot        - Telegram –±–æ—Ç"
    echo "  frontend   - Frontend"
    echo "  redis      - Redis –∫—ç—à"
    echo "  certbot    - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)"
    echo ""
    echo "–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:"
    echo "  follow     - —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
    echo ""
    echo "–ü—Ä–∏–º–µ—Ä—ã:"
    echo "  ./logs.sh web          # –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ API"
    echo "  ./logs.sh bot follow   # –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –±–æ—Ç–∞"
    echo "  ./logs.sh all follow   # –°–ª–µ–¥–∏—Ç—å –∑–∞ –≤—Å–µ–º–∏ –ª–æ–≥–∞–º–∏"
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
case $SERVICE in
    help|--help|-h)
        show_help
        exit 0
        ;;
    all|web|bot|frontend|redis|certbot)
        # –í–∞–ª–∏–¥–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
        ;;
    *)
        echo "‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å: $SERVICE"
        show_help
        exit 1
        ;;
esac

# –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—É
if [ "$SERVICE" = "all" ]; then
    CMD="docker-compose logs"
else
    CMD="docker-compose logs $SERVICE"
fi

# –î–æ–±–∞–≤–ª—è–µ–º —Ñ–ª–∞–≥ follow –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
if [ "$FOLLOW" = "follow" ] || [ "$FOLLOW" = "-f" ]; then
    CMD="$CMD -f"
fi

echo "üîç –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è: $CMD"
echo "   (–î–ª—è –≤—ã—Ö–æ–¥–∞ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C)"
echo ""

# –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É
eval $CMD