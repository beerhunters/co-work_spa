#!/bin/bash

# =============================================================================
# –û–°–¢–ê–ù–û–í–ö–ê –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
# =============================================================================

set -e

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Coworking Management System..."

# –ü–æ–ª—É—á–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É (–Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ –æ—Ç scripts)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$PROJECT_DIR"

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ "$BUILD_TARGET" = "production" ] || [ "$ENVIRONMENT" = "production" ]; then
    echo "üè≠ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤–∫–ª—é—á–∞—è certbot)..."
    docker-compose --profile production down
else
    echo "üè† –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤..."
    docker-compose down
fi

echo "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
echo ""
echo "üìã –î–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ (–≤–∫–ª—é—á–∞—è volumes):"
echo "  docker-compose --profile production down -v"
echo "  docker-compose down -v"
echo ""
echo "üîÑ –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "  ./scripts/start-local.sh   # –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º"
echo "  ./scripts/start-prod.sh    # –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∂–∏–º"